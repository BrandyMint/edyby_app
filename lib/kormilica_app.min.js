!function(){(function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b};define("models/profile",[],function(){"use strict";var a,c;return a=function(a){function d(){return c=d.__super__.constructor.apply(this,arguments)}return b(d,a),d.prototype.initialize=function(){return this.localStorage=new Backbone.LocalStorage("profiles"),this.on("change:name change:phone",function(){return this.save()})},d.prototype.defaults={id:1,name:"",phone:""},d.prototype.isAllFieldsFilled=function(){return this.get("name")&&this.get("phone")?!0:void 0},d}(Backbone.Model)})}).call(this),function(){define("templates/modal_windows/quantity_selector",[],function(){return function(a){var b;return b=function(){var a,b,c;return b=function(a){return(""+a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#39;").replace(/\//g,"&#47;").replace(/"/g,"&quot;")},a=function(a){switch(a){case null:case void 0:return"";case!0:case!1:return""+a;default:return a}},c=[],c.push("<div class='modal-wrapper'>\n  <div class='dark-background'></div>\n  <div class='modal-window'>\n    <div class='column full'>\n      <div class='quantity-title'>Введите количество</div>\n      <table class='quantity-table'>\n        <tr>\n          <td>\n            <p class='price'>\n              <span class='price-font'>"+a(this.money(this.product.get("price")))+"</span>\n              р.\n            </p>\n          </td>\n          <td>\n            <p class='multiplier'>x\n              <span class='multiplier-font quantity'>"+b(a(this.quantity))+"</span>\n              =\n            </p>\n          </td>\n          <td>\n            <p class='price result'>"+a(this.money(this.total_cost))+"</p>\n          </td>\n        </tr>\n      </table>\n      <div class='quantity-selector'>\n        <a id='plus-sign' href='#'>+</a>\n        <span class='quantity'>"+this.quantity+"</span>\n        шт\n        <a id='minus-sign' href='#'>-</a>\n      </div>\n      <a class='button' href='#'>\n        <span>ГОТОВО</span>\n      </a>\n    </div>\n  </div>\n</div>"),c.join("\n").replace(/\s([\w-]+)='true'/gm," $1").replace(/\s([\w-]+)='false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")},b.call(a)}})}.call(this),function(){define("helpers/application_helpers",[],function(){return{ficon:function(a){return"<i class='fontello-icon-"+a+"'></i>"},badge:function(a,b){return'<span class="badge badge-'+(b?b:"default")+'">'+a+"</span>"},truncate:function(a,b){var c,d;return null==b&&(b=100),a.length<b?a:(d=$.trim(a).substring(0,b).split(" "),c=d.join(" ")+"&hellip;")},url:function(a){return App.urls[a]||"Неизвестный url_name "+a},money:function(a){return"<span class='price-font'>"+a.cents/100+"</span> р."},moneyWithoutCurrency:function(a){return""+a.cents/100}}})}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b};define("views/modal_windows/quantity_selector",["templates/modal_windows/quantity_selector","helpers/application_helpers"],function(a,c){var d,e;return d=function(d){function f(){return e=f.__super__.constructor.apply(this,arguments)}return b(f,d),f.prototype.template=a,f.prototype.templateHelpers=function(){return c},f.prototype.ui={plusButton:"#plus-sign",minusButton:"#minus-sign",confirmButton:".button",quantity:".quantity",result:".result",outside:".dark-background"},f.prototype.triggers={"click @ui.outside":"close"},f.prototype.events={"click @ui.minusButton":"decreaseQuantity","click @ui.plusButton":"increaseQuantity","click @ui.confirmButton":"confirmChanges"},f.prototype.serializeData=function(){return _.extend(this.model.toJSON(),{product:this.model.product})},f.prototype.decreaseQuantity=function(a){return a.preventDefault(),this.model.get("quantity")<1?void 0:(this.model.set("quantity",this.model.get("quantity")-1),this._updateView())},f.prototype.increaseQuantity=function(a){return a.preventDefault(),this.model.set("quantity",this.model.get("quantity")+1),this._updateView()},f.prototype.confirmChanges=function(a){return a.preventDefault(),this.close()},f.prototype.onClose=function(){return 0===this.model.get("quantity")?this.model.destroy():void 0},f.prototype._updateView=function(){return $(this.ui.quantity).html(this.model.get("quantity")),$(this.ui.result).html(c.money(this.model.get("total_cost")))},f}(Marionette.ItemView)})}.call(this),function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b={}.hasOwnProperty,c=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a};define("controllers/cart",["views/modal_windows/quantity_selector"],function(b){var d,e;return d=function(d){function f(){return this.productClick=a(this.productClick,this),e=f.__super__.constructor.apply(this,arguments)}return c(f,d),f.prototype.initialize=function(a){var b=this;return this.vent=a.vent,this.modal=a.modal,this.cart=a.cart,this.vent.on("product:click",this.productClick),this.vent.on("cart:clean order:created",function(){return b.cleanCart()})},f.prototype.productClick=function(a){var c;return c=this.cart.items.itemOfProduct(a),c?this.modal.show(new b({model:c})):this.cart.addProduct(a)},f.prototype.deleteItem=function(){return this.vent.trigger("cart:item:deleted")},f.prototype.cleanCart=function(){var a,b;for(b=[];a=this.cart.items.first();)b.push(a.destroy());return b},f}(Marionette.Controller)})}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b};define("models/cart_item",[],function(){"use strict";var a,c;return a=function(a){function d(){return c=d.__super__.constructor.apply(this,arguments)}return b(d,a),d.prototype.defaults={quantity:1},d.prototype.initialize=function(){return this.product=window.App.products.get(this.get("product_id")),this.set({product_title:this.product.get("title"),product_price:this.product.get("price")}),this.on("change:quantity",this.updateTotalCost),this.updateTotalCost()},d.prototype.updateTotalCost=function(){var a;return a=this.product.get("price").cents*this.get("quantity"),this.set({total_cost:{cents:a,currency:this.product.get("price").currency},total_cost_cents:a})},d}(Backbone.Model)})}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b};define("collections/cart_items",["models/cart_item"],function(a){var c,d;return c=function(c){function e(){return d=e.__super__.constructor.apply(this,arguments)}return b(e,c),e.prototype.url="cart",e.prototype.model=a,e.prototype.initialize=function(){return this.localStorage=new Backbone.LocalStorage("cart_items")},e.prototype.getTotalCost=function(){var a;return a=function(a,b){return b.get("total_cost").cents+a},{cents:this.reduce(a,0),currency:"RUB"}},e.prototype.getTotalCount=function(){var a;return a=function(a,b){return b.get("quantity")+a},this.reduce(a,0)},e.prototype.isProductInCart=function(a){return!!this.cartItem(a)},e.prototype.itemOfProduct=function(a){return this.findWhere({product_id:a.id})},e}(Backbone.Collection)})}.call(this),function(){define("templates/check/check",[],function(){return function(a){var b;return b=function(){var a,b,c;return b=function(a){return(""+a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#39;").replace(/\//g,"&#47;").replace(/"/g,"&quot;")},a=function(a){switch(a){case null:case void 0:return"";case!0:case!1:return""+a;default:return a}},c=[],c.push("<div id='check-top-external'>\n  <div class='center' id='check-top-internal'>\n    <div class='check-top-battlement'>\n      <div class='check-top-battlement-center'></div>\n    </div>\n    <div class='check-content'>\n      <div class='scrollable-check'>\n        <div class='check-header'>\n          <a href='#'>\n            <img src='images/back-button.png'>\n          </a>\n          <h2>Ваш чек</h2>\n        </div>\n        <div class='cart-items'></div>\n      </div>\n      <div class='unscrollable-check'>\n        <div class='clearfix row'>\n          <p class='all-product-sum'>Итог:\n            <span class='all-sum-right'>"+a(this.money(this.total_cost))+"</span>\n          </p>\n        </div>\n        <form name='message\", method=>\"post'>\n          <section>\n            <label for='phone'>Телефон:</label>\n            <input id='phone' type='tel' value='"+b(a(this.profile.get("phone")?this.profile.get("phone"):void 0))+"' name='phone' placeholder='+7(999)999-99-99'>\n            <label for='name'>Ваше имя:</label>\n            <input id='name' type='text' value='"+b(a(this.profile.get("name")?this.profile.get("name"):void 0))+"' name='name'>\n          </section>\n        </form>\n        <p class='form-comment'>\n          обязательно введите свой телефон для связи\n        </p>\n      </div>\n    </div>\n  </div>\n</div>"),c.join("\n").replace(/\s([\w-]+)='true'/gm," $1").replace(/\s([\w-]+)='false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")},b.call(a)}})}.call(this),function(){define("templates/check/check_cart_item",[],function(){return function(a){var b;return b=function(){var a,b,c;return b=function(a){return(""+a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#39;").replace(/\//g,"&#47;").replace(/"/g,"&quot;")},a=function(a){switch(a){case null:case void 0:return"";case!0:case!1:return""+a;default:return a}},c=[],c.push("<p>"+b(a("Число. "+this.product_title))+"</p>\n<table>\n  <tbody>\n    <tr>\n      <td class='product-amount'>"),c.push("        "+a(this.moneyWithoutCurrency(this.product_price))),c.push("        x"),c.push("        "+b(a(this.quantity))),c.push("      </td>\n      <td class='separator'>\n        <div></div>\n      </td>\n      <!-- / TODO Мультивалютность -->\n      <td class='product-price'>"+b(a(""+this.moneyWithoutCurrency(this.total_cost)+" р."))+"</td>\n    </tr>\n  </tbody>\n</table>"),c.join("\n").replace(/\s([\w-]+)='true'/gm," $1").replace(/\s([\w-]+)='false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")},b.call(a)}})}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b};define("views/check/check_cart_item",["templates/check/check_cart_item","helpers/application_helpers"],function(a,c){var d,e;return d=function(d){function f(){return e=f.__super__.constructor.apply(this,arguments)}return b(f,d),f.prototype.template=a,f.prototype.templateHelpers=function(){return c},f}(Marionette.ItemView)})}.call(this),function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b={}.hasOwnProperty,c=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a};define("views/check/check",["templates/check/check","views/check/check_cart_item","helpers/application_helpers"],function(b,d,e){var f,g;return f=function(f){function h(){return this.checkForEmptyFields=a(this.checkForEmptyFields,this),g=h.__super__.constructor.apply(this,arguments)}return c(h,f),h.prototype.template=b,h.prototype.templateHelpers=function(){return e},h.prototype.itemView=d,h.prototype.itemViewContainer=".cart-items",h.prototype.initialize=function(a){return this.cart=a.cart,this.profile=a.profile,this.collection=this.cart.items,this.model=this.profile},h.prototype.bindings={"#name":{observe:"name"},"#phone":{observe:"phone"}},h.prototype.ui={form:"form",backButton:".check-header a"},h.prototype.events={"keyup form":"checkForEmptyFields"},h.prototype.triggers={"click @ui.backButton":{event:"cancel:button:clicked",preventDefault:!0}},h.prototype.serializeData=function(){return _.extend(this.cart.toJSON(),{items:this.cart.items.toJSON(),profile:this.profile})},h.prototype.checkForEmptyFields=function(){var a,b,c;b=this.ui.form.serializeObject(),a=[];for(c in b)b[c]||a.push(c);return this.trigger(a.length>0?"check:form:empty:field":"check:form:filled")},h.prototype._setScrollableAreaHeight=function(){var a,b,c,d;return b=$(".check-content"),a=$(".unscrollable-check"),c=$(".scrollable-check"),d=b.height()-a.height(),c.css("height",d)},h.prototype.onShow=function(){return this._setScrollableAreaHeight()},h.prototype.onRender=function(){return this.stickit()},h}(Marionette.CompositeView)})}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b};define("controllers/check",["views/check/check"],function(a){var c,d;return c=function(c){function e(){return d=e.__super__.constructor.apply(this,arguments)}return b(e,c),e.prototype.initialize=function(b){var c=this;return this.profile=b.profile,this.cart=b.cart,this.app=b.app,this.checkView=new a({profile:this.profile,cart:this.cart}),this.app.reqres.setHandler("form:data",function(){return c.checkView.$el.find("form").serializeObject()}),this.app.vent.on("checkout:clicked",function(){return c.showCheck(),c.app.vent.trigger("check:appeared")}),this.app.vent.on("order:created",function(){return c.hideCheck(),c.app.vent.trigger("check:disappeared")}),this.checkView.on("check:form:empty:field",function(){return c.app.vent.trigger("check:form:invalid")}),this.checkView.on("check:form:filled",function(){return c.app.vent.trigger("check:form:valid")}),this.checkView.on("cancel:button:clicked",function(){return c.app.vent.trigger("check:disappeared"),c.hideCheck()})},e.prototype.showCheck=function(){return this.app.checkRegion.show(this.checkView)},e.prototype.hideCheck=function(){return this.app.checkRegion.close()},e}(Marionette.Controller)})}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b};define("models/product",["app"],function(){"use strict";var a,c;return a=function(a){function d(){return c=d.__super__.constructor.apply(this,arguments)}return b(d,a),d.prototype.urlRoot="products",d}(Backbone.Model)})}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b};define("collections/products",["models/product"],function(a){var c,d;return c=function(c){function e(){return d=e.__super__.constructor.apply(this,arguments)}return b(e,c),e.prototype.url="products",e.prototype.model=a,e}(Backbone.Collection)})}.call(this),function(){define("templates/products/product",[],function(){return function(a){var b;return b=function(){var a,b,c;return b=function(a){return(""+a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#39;").replace(/\//g,"&#47;").replace(/"/g,"&quot;")},a=function(a){switch(a){case null:case void 0:return"";case!0:case!1:return""+a;default:return a}},c=[],c.push("<div class='clearfix row'>\n  <div class='column two-thirds'>\n    <img src='"+b(a(this.image_url))+"'>\n    <p>"+b(a(this.title))+"</p>\n    <p class='price'>"+a(this.money(this.price))+"</p>\n  </div>\n  <div class='column one-thirds product-quantity'></div>\n</div>"),c.join("\n").replace(/\s([\w-]+)='true'/gm," $1").replace(/\s([\w-]+)='false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")},b.call(a)}})}.call(this),function(){define("templates/products/button",[],function(){return function(a){var b;return b=function(){var a;return a=[],a.push("<a class='button' href='#777'>\n  <img src='images/to-bucket.png'>\n    <span>В ЗАКАЗ</span>\n</a>"),a.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")},b.call(a)}})}.call(this),function(){define("templates/products/button_added",[],function(){return function(a){var b;return b=function(){var a;return a=[],a.push("<a class='button in-order' href='#777'>\n  <img src='images/to-bucket-orange.png'>\n    <span>В ЗАКАЗE "+this.quantity+" шт</span>\n</a>"),a.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")},b.call(a)}})}.call(this),function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b={}.hasOwnProperty,c=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a};define("views/products/product",["templates/products/product","templates/products/button","templates/products/button_added","helpers/application_helpers"],function(b,d,e,f){var g,h;return g=function(g){function i(){return this.showButton=a(this.showButton,this),this.cartChanged=a(this.cartChanged,this),h=i.__super__.constructor.apply(this,arguments)}return c(i,g),i.prototype.templateHelpers=function(){return f},i.prototype.template=b,i.prototype.className="product-block",i.prototype.ui={button:".product-quantity"},i.prototype.events={click:"clicked"},i.prototype.initialize=function(a){return this.app=a.app,this.cartItems=a.cartItems,this.listenTo(this.cartItems,"add",this.cartChanged),this.listenTo(this.cartItems,"remove",this.cartChanged)},i.prototype.clicked=function(a){return a.preventDefault(),this.app.vent.trigger("product:click",this.model)},i.prototype.cartChanged=function(a){return a.get("product_id")===this.model.id?this.showButton():void 0},i.prototype.showButton=function(){var a;return this.ui.button.html((a=window.App.cart.items.itemOfProduct(this.model))?e({quantity:a.get("quantity")}):d())},i.prototype.onRender=function(){return this.showButton()},i}(Marionette.ItemView)})}.call(this),function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b={}.hasOwnProperty,c=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a};define("views/products/products",["views/products/product"],function(b){var d,e;return d=function(d){function f(){return this.itemViewOptions=a(this.itemViewOptions,this),e=f.__super__.constructor.apply(this,arguments)}return c(f,d),f.prototype.itemView=b,f.prototype.initialize=function(a){return this.app=a.app,a},f.prototype.itemViewOptions=function(){return{app:this.app,cartItems:this.app.cart.items}},f}(Marionette.CollectionView)})}.call(this),function(){define("templates/header/header",[],function(){return function(a){var b;return b=function(){var a;return a=[],a.push("<div class='clearfix row'>\n  <div class='column half' id='logo'>\n    <img src='images/logo.png'>\n    <p>Доставка <br> пончиков</p>\n  </div>\n  <div class='column half' id='check'>\n    <img src='images/header-check.png'>\n    <p>ваш заказ на \n      <br>\n      <span id='amount'></span>\n    </p>\n  </div>\n</div>"),a.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")},b.call(a)}})}.call(this),function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b={}.hasOwnProperty,c=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a};define("views/header/header",["templates/header/header","helpers/application_helpers"],function(b,d){var e,f;return e=function(e){function g(){return this.bounce=a(this.bounce,this),f=g.__super__.constructor.apply(this,arguments)}return c(g,e),g.prototype.template=b,g.prototype.className="header",g.prototype.templateHelpers=function(){return d},g.prototype.triggers={"click #check":"check:clicked"},g.prototype.modelEvents={change:"update"},g.prototype.initialize=function(a){return this.app=a.app,this.cart=a.cart,this.model=this.cart,this.cart.on("add",this.bounce)},g.prototype.update=function(){return this.model.isEmpty()?this.hideCheck():this.showCheck(),this.changeCost()},g.prototype.showCheck=function(){return this.$("#check").html(this.checkDOM)},g.prototype.hideCheck=function(){return this.$("#check").children().remove()},g.prototype.bounce=function(){return this.$("#check img").effect("bounce",{times:2},150)},g.prototype.changeCost=function(){return this.$("#amount").html(d.money(this.model.get("total_cost")))},g.prototype.onRender=function(){return this.checkDOM=this.$("#check").children().clone(),this.update()},g}(Marionette.ItemView)})}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b};define("controllers/header",["views/header/header"],function(a){var c,d;return c=function(c){function e(){return d=e.__super__.constructor.apply(this,arguments)}return b(e,c),e.prototype.initialize=function(b){var c=this;return this.cart=b.cart,this.app=b.app,this.headerView=new a({app:this.app,cart:this.cart}),this.showHeader(),this.headerView.on("check:clicked",function(){return this.app.vent.trigger("checkout:show")}),this.app.vent.on("check:appeared",function(){return c.hideHeader()}),this.app.vent.on("check:disappeared",function(){return c.showHeader()})},e.prototype.hideHeader=function(){return $("#app-container").addClass("checkout-state"),this.app.headerRegion.close()},e.prototype.showHeader=function(){return $("#app-container").removeClass("checkout-state"),this.app.headerRegion.show(this.headerView)},e}(Marionette.Controller)})}.call(this),function(){define("templates/footer/footer",[],function(){return function(a){var b;return b=function(){var a;return a=[],a.push("<div class='clearfix row' id='check-bottom'></div>\n<div class='clearfix row' id='workspace'>\n  <div class='column delivery-discount full'>\n    <p>Выберите блюдо на заказ.</p>\n    <p class='free-delivery'>Доставка бесплатно от 500 руб.</p>\n  </div>\n</div>"),a.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")},b.call(a)}})}.call(this),function(){define("templates/footer/_checkout",[],function(){return function(a){var b;return b=function(){var a;return a=[],a.push("<div class='column footer-content full'>\n  <a class='button checkout' href='#777'>ОФОРМИТЬ ЗАКАЗ</a>\n</div>"),a.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")},b.call(a)}})}.call(this),function(){define("templates/footer/_delivery",[],function(){return function(a){var b;return b=function(){var a,b,c;return b=function(a){return(""+a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#39;").replace(/\//g,"&#47;").replace(/"/g,"&quot;")},a=function(a){switch(a){case null:case void 0:return"";case!0:case!1:return""+a;default:return a}},c=[],c.push("<div class='"+["column","full","footer-content",""+b(a(this.isAllFieldsFilled()===!0?"delivery":"delivery-inactive"))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"'>\n  <a class='button' href='#777'>ДОСТАВИТЬ ЗАКАЗ</a>\n</div>"),c.join("\n").replace(/\s([\w-]+)='true'/gm," $1").replace(/\s([\w-]+)='false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")},b.call(a)}})}.call(this),function(){define("templates/footer/_check_bottom",[],function(){return function(a){var b;return b=function(){var a;return a=[],a.push("<div class='column full'>\n  <div id='check-bottom-hidden'>\n    <div class='check-short-battlement'>\n      <div class='check-short-battlement-center'></div>\n    </div>\n    <div class='check-short-left'></div>\n    <div class='check-short-right'></div>\n    <div class='check-short-center'></div>\n  </div>\n</div>"),a.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")},b.call(a)}})}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b};define("views/footer/footer",["templates/footer/footer","templates/footer/_checkout","templates/footer/_delivery","templates/footer/_check_bottom"],function(a,c,d,e){var f,g;return f=function(f){function h(){return g=h.__super__.constructor.apply(this,arguments)}return b(h,f),h.prototype.template=a,h.prototype.initialize=function(a){var b=this;return this.profile=a.profile,this.app=a.app,this.cart=a.cart,this.collection=this.cart.items,this.app.vent.on("check:appeared",function(){return b.showDeliveryButton(),b.showCheckBottom()}),this.app.vent.on("check:form:invalid",function(){return b.deactivateDeliveryButton()}),this.app.vent.on("check:form:valid",function(){return b.activateDeliveryButton()}),this.app.vent.on("check:disappeared",function(){return b.showCheckoutButton()}),this.app.vent.on("order:created",function(){return b.hideButton()})},h.prototype.events={"click a.checkout":"showCheck","click .delivery a":"addOrder","click .delivery-inactive a":"showErrors"},h.prototype.collectionEvents={add:"showCheckoutButton",remove:"hideButton"},h.prototype.showCheckoutButton=function(){return this.$("#workspace").html(c)},h.prototype.showDeliveryButton=function(){return this.$("#workspace").html(d(this.profile))},h.prototype.deactivateDeliveryButton=function(){var a;return a=this.$("#workspace").find(".delivery"),a.removeClass("delivery").addClass("delivery-inactive")},h.prototype.activateDeliveryButton=function(){var a;return a=this.$("#workspace").find(".delivery-inactive"),a.removeClass("delivery-inactive").addClass("delivery")},h.prototype.hideButton=function(){return this.cart.isEmpty()?(this.$("#workspace").html(this.workspaceDOM),this.$("#check-bottom").children().remove()):void 0},h.prototype.showCheckBottom=function(){return this.$("#check-bottom").html(e)},h.prototype.showCheck=function(a){return a.preventDefault(),this.showDeliveryButton(),this.trigger("checkout:clicked")},h.prototype.addOrder=function(a){return a.preventDefault(),this.trigger("delivery:clicked"),this.hideButton()},h.prototype.showErrors=function(a){return a.preventDefault(),alert("Заполните все поля")},h.prototype.onRender=function(){return this.workspaceDOM=this.$("#workspace").children().clone(),this.cart.isEmpty()?void 0:this.showCheckoutButton()},h}(Marionette.ItemView)})}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b};define("controllers/footer",["views/footer/footer"],function(a){var c,d;return c=function(c){function e(){return d=e.__super__.constructor.apply(this,arguments)}return b(e,c),e.prototype.initialize=function(b){var c=this;return this.cart=b.cart,this.app=b.app,this.profile=b.profile,this.vent=b.vent,this.footerView=new a({app:this.app,cart:this.cart,profile:this.profile}),this.showFooter(),this.footerView.on("checkout:clicked",function(){return c.vent.trigger("checkout:clicked")}),this.footerView.on("delivery:clicked",function(){return c.app.execute("order:create")})},e.prototype.showFooter=function(){return this.app.footerRegion.show(this.footerView)},e}(Marionette.Controller)})}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b};define("models/order",[],function(){var a,c;return a=function(a){function d(){return c=d.__super__.constructor.apply(this,arguments)}return b(d,a),d.prototype.url="http://api.aydamarket.ru/v1/orders.json",d.prototype.sync=function(a,b,c){return c.headers={"X-Vendor-Key":"467abe2e7d33e6455fe905e879fd36be"},Backbone.sync(a,b,c)},d}(Backbone.Model)})}.call(this),function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b={}.hasOwnProperty,c=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a};define("controllers/order",["models/order"],function(b){var d,e;return d=function(d){function f(){return this.createOrder=a(this.createOrder,this),e=f.__super__.constructor.apply(this,arguments)}return c(f,d),f.prototype.initialize=function(a){var b=this;return this.app=a.app,this.cart=a.cart,this.profile=a.profile,this.app.commands.setHandler("order:create",function(){return b.createOrder()})},f.prototype.createOrder=function(){var a,c,d=this;return c={user:{phone:this.profile.get("phone"),name:this.profile.get("name")},items:this._getFormattedCartItems(),total_price:this.cart.get("total_cost")},a=new b(c),a.save(null,{success:function(a,b){return alert("Ваш заказ №"+b.id),d.app.vent.trigger("order:created",b)}})},f.prototype._getFormattedCartItems=function(){var a,b,c,d,e;for(d=this.cart.items.toJSON(),e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(a={product_id:a.product_id,count:a.quantity,price:a.total_cost_cents});return e},f}(Marionette.Controller)})}.call(this),function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b={}.hasOwnProperty,c=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a};define("models/cart",["collections/cart_items"],function(b){"use strict";var d,e;return d=function(d){function f(){return this.updateAggregators=a(this.updateAggregators,this),e=f.__super__.constructor.apply(this,arguments)}return c(f,d),f.prototype.initialize=function(){return this.items=new b,this.listenTo(this.items,"add change remove",this.updateAggregators),this.updateAggregators()},f.prototype.fetch=function(){return this.items.fetch()},f.prototype.updateAggregators=function(){var a;return a=this.items.getTotalCost(),this.set({total_cost:a,total_count:this.items.getTotalCount(),total_cost_cents:a.cents})},f.prototype.isEmpty=function(){return 0===this.items.length},f.prototype.changeQuantity=function(a,b){var c;return c=this.items.itemOfProduct(a),c.set("quantity",b),c.save()},f.prototype.addProduct=function(a){return this.items.create({product_id:a.id})},f.prototype.removeProduct=function(a){var b;return b=this.items.itemOfProduct(a),null!=b?b.destroy():void 0},f}(Backbone.Model)})}.call(this),function(){define("controllers/modal",[],function(){var a;return a=function(){function a(a){this.modalRegion=a.modalRegion}return a.prototype.show=function(a){return a.on("onClose",this.hide),$("#app-container").addClass("modal-state"),this.modalRegion.show(a)},a.prototype.hide=function(){return $("#app-container").removeClass("modal-state"),this.modalRegion.close()},a}()})}.call(this),function(){define("data/vendor_predefined",[],function(){return{key:"467abe2e7d33e6455fe905e879fd36be",name:"Тестовый вендор",mobile_description:"Только у нас, <b>жирные пончики</b>. В течении часа.",mobile_subject:"Супер пончики",phone:"79033891228",city:"Чебоксары",minimal_price:{cents:0,currency:"RUB"},delivery_price:{cents:0,currency:"RUB"},currency:"RUB",categories:[{id:1,name:"Пончики"}],products:[{id:7,category_id:1,title:"Пончик с начинкой яблоко-корица",price:{cents:1e4,currency:"RUB"},image_url:"http://aydamarket.ru/uploads/product/image/7/kak_prigotovit_ponchiki_s_glazuryu.jpg"},{id:6,category_id:1,title:"Пончик с банановой начинкой",price:{cents:11e3,currency:"RUB"},image_url:"http://aydamarket.ru/uploads/product/image/6/kak_prigotovit_ponchiki_s_glazuryu.jpg"},{id:5,category_id:1,title:" Пончик с начинкой лесные ягоды",price:{cents:12e3,currency:"RUB"},image_url:"http://aydamarket.ru/uploads/product/image/5/kak_prigotovit_ponchiki_s_glazuryu.jpg"},{id:4,category_id:1,title:"Пончик с начинкой двойной шоколад",price:{cents:13e3,currency:"RUB"},image_url:"http://aydamarket.ru/uploads/product/image/4/kak_prigotovit_ponchiki_s_glazuryu.jpg"},{id:3,category_id:1,title:"Пончик с творожной начинкой",price:{cents:14e3,currency:"RUB"},image_url:"http://aydamarket.ru/uploads/product/image/3/kak_prigotovit_ponchiki_s_glazuryu.jpg"},{id:2,category_id:1,title:"Пончик со сливочной начинкой",price:{cents:15e3,currency:"RUB"},image_url:"http://aydamarket.ru/uploads/product/image/2/kak_prigotovit_ponchiki_s_glazuryu.jpg"},{id:1,category_id:1,title:"Пончик с начинкой ваниль",price:{cents:16e3,currency:"RUB"},image_url:"http://aydamarket.ru/uploads/product/image/1/kak_prigotovit_ponchiki_s_glazuryu.jpg"}]}
})}.call(this),function(){define("app",["models/profile","controllers/cart","collections/cart_items","controllers/check","collections/products","views/products/products","controllers/header","controllers/footer","controllers/order","models/cart","controllers/modal","data/vendor_predefined"],function(a,b,c,d,e,f,g,h,i,j,k){var l;return l=new Marionette.Application,l.addRegions({headerRegion:"#header-region",mainRegion:"#main-region",footerRegion:"#footer-region",checkRegion:"#check-region",modalRegion:"#modal-region"}),l.modal=new k({modalRegion:l.modalRegion}),l.addInitializer(function(c){var k;return l.vendor=new Backbone.Model(c.vendor),l.categories=new Backbone.Collection(c.vendor.categories),l.products=new e(c.vendor.products),l.profile=new a,l.profile.fetch(),l.cart=new j,l.cart.fetch(),new b({vent:l.vent,cart:l.cart,modal:l.modal}),new d({app:l,profile:l.profile,cart:l.cart}),new i({app:l,cart:l.cart,profile:l.profile}),k=new f({app:l,collection:l.products}),l.mainRegion.show(k),new g({app:l,cart:l.cart}),new h({app:l,cart:l.cart,profile:l.profile,vent:l.vent})}),l.on("start",function(){return console.log("App starting....")}),l})}.call(this),function(){"use strict";require.config({shim:{underscore:{exports:"_"}},paths:{jquery:"../bower_components/jquery/jquery",underscore:"../bower_components/underscore/underscore","form-serialize":"lib/form-serialize"}}),require(["app"])}.call(this),define("main",function(){})}();